<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vyper Stats - Analizador de Servidores Minecraft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Courier New', monospace;
        }
        
        body {
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(28, 58, 173, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(128, 0, 128, 0.1) 0%, transparent 20%);
        }
        
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            z-index: 1;
            position: relative;
        }
        
        @keyframes rgb-border {
            0% { 
                border-image: linear-gradient(90deg, #00ffff, #ff00ff, #ffff00, #00ff00) 1;
                box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            }
            25% { 
                border-image: linear-gradient(90deg, #ff00ff, #ffff00, #00ff00, #00ffff) 1;
                box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
            }
            50% { 
                border-image: linear-gradient(90deg, #ffff00, #00ff00, #00ffff, #ff00ff) 1;
                box-shadow: 0 0 20px rgba(255, 255, 0, 0.3);
            }
            75% { 
                border-image: linear-gradient(90deg, #00ff00, #00ffff, #ff00ff, #ffff00) 1;
                box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            }
            100% { 
                border-image: linear-gradient(90deg, #00ffff, #ff00ff, #ffff00, #00ff00) 1;
                box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            }
        }

        @keyframes rgb-text {
            0% { 
                background-position: 0% 50%;
                filter: hue-rotate(0deg);
            }
            50% { 
                background-position: 100% 50%;
            }
            100% { 
                background-position: 0% 50%;
                filter: hue-rotate(360deg);
            }
        }
        
        header {
            text-align: center;
            padding: 30px;
            margin-bottom: 40px;
            border-bottom: 3px solid transparent;
            animation: rgb-border 3s infinite linear;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }
        
        h1 {
            font-size: 3.5rem;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #ffff00, #00ff00, #00ffff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
            animation: rgb-text 4s infinite linear;
            background-size: 300% 300%;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #a0a0ff;
            letter-spacing: 2px;
            margin-bottom: 20px;
        }
        
        .input-section {
            background: rgba(10, 10, 40, 0.7);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 0 30px rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .history-section {
            background: rgba(10, 10, 40, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .history-title {
            font-size: 1.3rem;
            color: #00ffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-controls {
            display: flex;
            gap: 10px;
        }

        .history-btn {
            padding: 8px 15px;
            background: rgba(0, 100, 200, 0.5);
            border: 1px solid #00aaff;
            border-radius: 5px;
            color: #00ffff;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .history-btn:hover {
            background: rgba(0, 150, 255, 0.7);
            transform: translateY(-2px);
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 20, 40, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-item:hover {
            background: rgba(0, 150, 255, 0.1);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-server {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-icon {
            color: #00aaff;
            font-size: 0.9rem;
        }

        .history-ip {
            color: #ffffff;
            font-weight: bold;
        }

        .history-port {
            color: #ffff00;
            font-size: 0.9rem;
        }

        .history-time {
            color: #8888ff;
            font-size: 0.8rem;
        }

        .history-empty {
            text-align: center;
            padding: 30px;
            color: #888;
            font-style: italic;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        label {
            font-size: 1.1rem;
            color: #00ffff;
            min-width: 200px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input, select {
            flex: 1;
            padding: 15px;
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid #00aaff;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            min-width: 300px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #ff00ff;
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }
        
        .btn {
            padding: 15px 40px;
            background: linear-gradient(90deg, #00aaff, #0088ff);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 170, 255, 0.5);
        }
        
        .btn:hover {
            background: linear-gradient(90deg, #0088ff, #00aaff);
            box-shadow: 0 0 25px rgba(0, 170, 255, 0.8);
            transform: translateY(-3px);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .results {
            display: none;
            background: rgba(5, 5, 25, 0.85);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 0 40px rgba(255, 0, 255, 0.1);
            border: 1px solid rgba(255, 0, 255, 0.2);
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .results-title {
            font-size: 1.8rem;
            color: #00ffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .info-card {
            background: rgba(15, 30, 60, 0.7);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
        }
        
        .card-1 { border-color: #00ffff; }
        .card-2 { border-color: #ff00ff; }
        .card-3 { border-color: #ffff00; }
        .card-4 { border-color: #00ff00; }
        .card-5 { border-color: #ff7700; }
        .card-6 { border-color: #aa00ff; }
        
        .card-title {
            font-size: 1.2rem;
            color: #aaddff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-content {
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .card-content p {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .card-content span {
            color: #00ffaa;
            font-weight: bold;
            text-align: right;
            max-width: 60%;
            word-break: break-word;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
        }
        
        .status-online {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .status-offline {
            background: rgba(255, 0, 0, 0.2);
            color: #ff5555;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .players-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .player-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .plugins-list-container {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .plugin-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 6px;
            background: rgba(0, 100, 200, 0.1);
            border-radius: 6px;
            border-left: 3px solid #00aaff;
        }
        
        .plugin-item:nth-child(even) {
            background: rgba(0, 150, 255, 0.1);
            border-left-color: #00ffff;
        }
        
        .plugin-count {
            background: linear-gradient(45deg, #0066ff, #00aaff);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-left: auto;
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 50px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #8888ff;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(0, 20, 40, 0.7);
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(0, 150, 255, 0.3);
            border-top: 5px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .examples {
            font-size: 0.9rem;
            color: #88aaff;
            margin-top: 10px;
            text-align: center;
        }
        
        .edition-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 50, 100, 0.5);
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .error-message {
            background: linear-gradient(90deg, rgba(255, 50, 0, 0.1), rgba(255, 150, 0, 0.1));
            border: 1px solid rgba(255, 100, 0, 0.5);
            color: #ffaaaa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
            border-left: 4px solid #ff5500;
            box-shadow: 0 0 20px rgba(255, 100, 0, 0.3);
        }
        
        .server-icon {
            width: 64px;
            height: 64px;
            border-radius: 10px;
            margin: 10px auto;
            display: block;
            border: 2px solid rgba(0, 255, 255, 0.5);
        }
        
        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
                align-items: flex-start;
            }
            
            input, select {
                min-width: 100%;
            }
            
            h1 {
                font-size: 2.5rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .history-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .history-controls {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-rocket"></i> Vyper Stats</h1>
            <p class="tagline">Analizador Avanzado de Servidores Minecraft - Java y Bedrock</p>
        </header>
        
        <section class="input-section">
            <div class="input-group">
                <div class="input-row">
                    <label for="target"><i class="fas fa-globe"></i> IP o Dominio:</label>
                    <input type="text" id="target" placeholder="Ej: play.hypixel.net, 8.8.8.8:19132, mc.hypixel.net">
                </div>
                
                <div class="input-row">
                    <label for="edition"><i class="fas fa-gamepad"></i> Edición del Servidor:</label>
                    <select id="edition">
                        <option value="auto">Detectar Automáticamente</option>
                        <option value="java">Java Edition</option>
                        <option value="bedrock">Bedrock Edition</option>
                    </select>
                </div>
                
                <div class="edition-info">
                    <i class="fas fa-info-circle"></i>
                    <p>Para Bedrock usa IP:PUERTO (ej: 8.8.8.8:19132). Para Java solo IP/dominio. Deja en automático para detección inteligente.</p>
                </div>
            </div>
            
            <button class="btn" id="analyzeBtn">
                <i class="fas fa-search"></i> Analizar Servidor
            </button>
            
            <p class="examples">Ejemplos: play.hypixel.net, mc.hypixel.net, 8.8.8.8:19132, mc.supercraft.es:25565</p>
            
            <div class="error-message" id="errorMessage"></div>
        </section>
        
        <section class="history-section" id="historySection">
            <div class="history-header">
                <h3 class="history-title"><i class="fas fa-history"></i> Historial de Consultas</h3>
                <div class="history-controls">
                    <button class="history-btn" id="toggleHistory">
                        <i class="fas fa-eye"></i> Mostrar/Ocultar
                    </button>
                    <button class="history-btn" id="clearHistory">
                        <i class="fas fa-trash"></i> Limpiar
                    </button>
                </div>
            </div>
            <div class="history-list" id="historyList" style="display: none;">
                <div class="history-empty" id="historyEmpty">
                    No hay consultas en el historial
                </div>
            </div>
        </section>
        
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p>Conectando con la API y analizando servidor...</p>
        </div>
        
        <section class="results" id="results">
            <div class="results-header">
                <h2 class="results-title"><i class="fas fa-chart-bar"></i> Resultados del Análisis</h2>
                <div class="status-indicator status-online" id="connectionStatus">CONECTANDO...</div>
            </div>
            
            <div id="serverIconContainer"></div>
            
            <div class="results-grid" id="resultsGrid">
            </div>
        </section>
        
        <footer>
            <p>Vyper Stats &copy; 2025 - Analizador de servidores Minecraft con API mcsrvstat.us</p>
            <p>Powered by Minecraft Server Status API | Herramienta hecha por Darko</p>
        </footer>
    </div>

    <script>
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const letters = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = [];
        
        for(let i = 0; i < columns; i++) {
            drops[i] = Math.floor(Math.random() * canvas.height / fontSize) * fontSize;
        }
        
        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#0f0';
            ctx.font = `${fontSize}px monospace`;
            
            for(let i = 0; i < drops.length; i++) {
                const text = letters.charAt(Math.floor(Math.random() * letters.length));
                const x = i * fontSize;
                const y = drops[i] * fontSize;
                
                ctx.fillStyle = Math.random() > 0.1 ? '#0f0' : '#0ff';
                ctx.fillText(text, x, y);
                
                if(y > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                
                drops[i]++;
            }
        }
        
                setInterval(drawMatrix, 50);
        
        window.addEventListener('resize', function() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        let history = JSON.parse(localStorage.getItem('vyperStatsHistory')) || [];
        const MAX_HISTORY = 50;

        function saveToHistory(target) {
            const now = new Date();
            const historyItem = {
                target: target,
                timestamp: now.getTime(),
                timeString: now.toLocaleTimeString('es-ES', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                })
            };

            history = history.filter(item => item.target !== target);
            history.unshift(historyItem);

            if (history.length > MAX_HISTORY) {
                history = history.slice(0, MAX_HISTORY);
            }

            localStorage.setItem('vyperStatsHistory', JSON.stringify(history));
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            const historyEmpty = document.getElementById('historyEmpty');
            
            if (!historyList || !historyEmpty) return;
            
            if (history.length === 0) {
                historyEmpty.style.display = 'block';
                historyList.innerHTML = '';
                return;
            }

            historyEmpty.style.display = 'none';
            let html = '';
            
            history.forEach((item, index) => {
                const [ip, port] = parseTarget(item.target);
                html += `
                    <div class="history-item" data-target="${item.target}" data-index="${index}">
                        <div class="history-server">
                            <i class="fas fa-server history-icon"></i>
                            <div>
                                <div class="history-ip">${ip}</div>
                                ${port ? `<div class="history-port">:${port}</div>` : ''}
                            </div>
                        </div>
                        <div class="history-time">${item.timeString}</div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;

            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    document.getElementById('target').value = target;
                    document.getElementById('analyzeBtn').click();
                });
            });
        }

        document.getElementById('toggleHistory').addEventListener('click', function() {
            const historyList = document.getElementById('historyList');
            if (historyList) {
                if (historyList.style.display === 'none') {
                    historyList.style.display = 'block';
                    updateHistoryDisplay();
                } else {
                    historyList.style.display = 'none';
                }
            }
        });

        document.getElementById('clearHistory').addEventListener('click', function() {
            if (confirm('¿Estás seguro de que quieres limpiar todo el historial?')) {
                history = [];
                localStorage.removeItem('vyperStatsHistory');
                updateHistoryDisplay();
            }
        });

        updateHistoryDisplay();
        
        document.getElementById('analyzeBtn').addEventListener('click', async function() {
            const target = document.getElementById('target').value.trim();
            const edition = document.getElementById('edition').value;
            
            if(!target) {
                showError('Por favor, ingresa la IP o dominio del servidor Minecraft');
                return;
            }
            
            const loadingElement = document.getElementById('loading');
            const resultsElement = document.getElementById('results');
            const errorElement = document.getElementById('errorMessage');
            
            if (loadingElement) loadingElement.style.display = 'block';
            if (resultsElement) resultsElement.style.display = 'none';
            if (errorElement) errorElement.style.display = 'none';
            
            try {
                const serverData = await fetchServerData(target, edition);
                displayResults(serverData);
                saveToHistory(target);
            } catch (error) {
                console.error('Error:', error);
                showError(`Error al analizar el servidor: ${error.message}`);
            } finally {
                if (loadingElement) loadingElement.style.display = 'none';
            }
        });
        
async function fetchServerData(target, edition) {
    const [ip, port] = parseTarget(target);
    
    let isBedrock = false;
    
    if (edition === 'bedrock') {
        isBedrock = true;
    } else if (edition === 'java') {
        isBedrock = false;
    } else {
        isBedrock = false;
    }
    
    const portNum = port || (isBedrock ? 19132 : 25565);
    
    const apiUrl = isBedrock 
        ? `https://api.mcsrvstat.us/bedrock/2/${ip}:${portNum}`
        : `https://api.mcsrvstat.us/2/${ip}:${portNum}`;
    
    try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);
        
        const response = await fetch(apiUrl, {
            signal: controller.signal,
            headers: {
                'Accept': 'application/json'
            }
        });
        
        clearTimeout(timeoutId);
        
        if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.online) {
            let pluginsList = [];
            let pingStatus = false;
            
            if (data.debug && data.debug.ping) {
                pingStatus = data.debug.ping;
            }
            
            if (data.plugins && data.plugins.names && Array.isArray(data.plugins.names)) {
                pluginsList = data.plugins.names;
            } else if (data.plugins && Array.isArray(data.plugins)) {
                pluginsList = data.plugins;
            }
            
            const playersList = data.players ? (data.players.list || []) : [];
            
            const formattedData = {
                online: data.online,
                hostname: data.hostname || ip,
                ip: data.ip || ip,
                port: portNum,
                players: {
                    online: data.players ? data.players.online : 0,
                    max: data.players ? data.players.max : 0,
                    list: playersList
                },
                version: data.version || 'Desconocido',
                motd: {
                    clean: data.motd ? (data.motd.clean || [data.motd]) : ['Sin MOTD']
                },
                software: data.software || 'Desconocido',
                plugins: pluginsList,
                debug: {
                    ping: pingStatus,
                    query: data.debug ? data.debug.query : false,
                    bedrock: isBedrock
                },
                _isBedrock: isBedrock,
                _apiUsed: 'mcsrvstat.us',
                icon: data.icon || null
            };
            
            return formattedData;
        } else {
            throw new Error('Servidor offline');
        }
        
    } catch (error) {
        if (error.name === 'AbortError') {
            throw new Error('Timeout: El servidor no respondió en 10 segundos');
        } else {
            throw new Error(`Error: ${error.message}`);
        }
    }
}

function parseTarget(target) {
    let ip = target;
    let port = null;
    
    if(target.includes(':')) {
        const lastColon = target.lastIndexOf(':');
        ip = target.substring(0, lastColon);
        port = target.substring(lastColon + 1);
        
        if(!port || isNaN(parseInt(port))) {
            ip = target;
            port = null;
        } else {
            port = parseInt(port);
        }
    }
    
    return [ip, port];
}

function displayResults(data) {
    const resultsGrid = document.getElementById('resultsGrid');
    const statusIndicator = document.getElementById('connectionStatus');
    const serverIconContainer = document.getElementById('serverIconContainer');
    const resultsElement = document.getElementById('results');
    
    if (!resultsGrid || !resultsElement) return;
    
    const isOnline = data.online === true;
    
    if(isOnline) {
        statusIndicator.className = 'status-indicator status-online';
        statusIndicator.innerHTML = `<i class="fas fa-check-circle"></i> SERVIDOR EN LÍNEA`;
    } else {
        statusIndicator.className = 'status-indicator status-offline';
        statusIndicator.innerHTML = `<i class="fas fa-times-circle"></i> SERVIDOR OFFLINE`;
        
        resultsGrid.innerHTML = `
            <div class="info-card card-1" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <h3 class="card-title"><i class="fas fa-server"></i> Servidor Offline</h3>
                <div class="card-content">
                    <p style="color:#ff5555; font-size: 1.2rem; margin-bottom: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> El servidor no está disponible
                    </p>
                    <p style="color:#aaaaaa; margin-bottom: 15px;">
                        No se puede obtener información porque el servidor está offline.
                    </p>
                    <p style="color:#888; font-style: italic;">
                        Verifica que la IP y el puerto sean correctos, y que el servidor esté encendido.
                    </p>
                </div>
            </div>
        `;
        
        resultsElement.style.display = 'block';
        return;
    }
    
    if(data.icon) {
        serverIconContainer.innerHTML = `<img src="${data.icon}" class="server-icon" alt="Icono del servidor">`;
    } else {
        serverIconContainer.innerHTML = '';
    }
    
    const isBedrock = data._isBedrock || false;
    const serverType = isBedrock ? 'Minecraft Bedrock Edition' : 'Minecraft Java Edition';
    const playersOnline = data.players && data.players.online ? data.players.online : 0;
    const playersMax = data.players && data.players.max ? data.players.max : 0;

    let version = 'No disponible';
    if (data.software && data.software !== 'Desconocido') {
      version = data.software;
    } else if (data.version) {
      version = data.version;
    }

    let pingStatus = data.debug && data.debug.ping;
    let pingText = 'No medido';
    let pingColor = '888888';

    if (pingStatus === true) {
    pingDisplay = '✓ OK';
    pingColor = '00ff00';
    } else if (pingStatus === false) {
    pingDisplay = '✗ Falló';
    pingColor = 'ff0000';
    }
       
    const hostname = data.hostname || data.ip || 'No disponible';
    const portInfo = data.port ? data.port : (isBedrock ? '19132' : '25565');
    
    let motdText = 'No disponible';
    if(data.motd) {
        if(data.motd.clean && Array.isArray(data.motd.clean)) {
            motdText = data.motd.clean.join(' ');
        } else if(typeof data.motd === 'string') {
            motdText = data.motd;
        }
    }
    
    let plugins = [];
    if(data.plugins && Array.isArray(data.plugins) && data.plugins.length > 0) {
        plugins = data.plugins;
    }
    
    const playersList = data.players && data.players.list ? data.players.list : [];
    const query = data.debug && data.debug.query === true ? 'Sí' : 'No';
    
    const dataToDisplay = {
        general: {
            title: 'Información General',
            icon: 'fas fa-server',
            items: [
                {label: 'Hostname:', value: `<strong style="color:#00ffff">${hostname}</strong>`},
                {label: 'IP:', value: data.ip ? `<code style="color:#ffff00">${data.ip}</code>` : 'No disponible'},
                {label: 'Puerto:', value: `<code style="color:#ffff00">${portInfo}</code>`},
                {label: 'Edición:', value: `<span style="color:#ffaa00">${serverType}</span>`},
                {label: 'Versión:', value: `<span style="color:#00ffaa">${version}</span>`},
                {label: 'MOTD:', value: `<span style="color:#ffffff">${motdText}</span>`}
            ]
        },
        players: {
            title: 'Jugadores',
            icon: 'fas fa-users',
            items: [
                {label: 'En línea:', value: `<span style="color:#ffff00; font-size: 1.2em">${playersOnline}</span> / <span style="color:#00ffff">${playersMax}</span>`},
                {label: 'Ocupación:', value: playersMax > 0 ? `<span style="color:#ffaa00">${((playersOnline/playersMax)*100).toFixed(1)}%</span>` : 'N/A'}
            ],
            playersList: playersList
        },
        technical: {
            title: 'Información Técnica',
            icon: 'fas fa-microchip',
            items: [
                {label: 'Bedrock:', value: isBedrock ? '<span style="color:#00ff00">✓ Sí</span>' : '<span style="color:#ff5555">✗ No</span>'},
                {label: 'Query:', value: query === 'Sí' ? '<span style="color:#00ff00">✓ Activado</span>' : '<span style="color:#ff5555">✗ Desactivado</span>'},
                {label: 'Ping API:', value: `<span style="color:#${pingColor}">${pingText}</span>`},
                {label: 'API usada:', value: `<span style="color:#ffaa00">mcsrvstat.us (datos) + mcstatus.io (ping)</span>`}
            ]
        },
        plugins: {
            title: 'Plugins',
            icon: 'fas fa-puzzle-piece',
            items: [
                {label: 'Total:', value: plugins.length > 0 ? `<span style="color:#00ff00; font-size: 1.2em">${plugins.length} plugins</span>` : '<span style="color:#888">No disponible</span>'}
            ],
            pluginsList: plugins
        }
    };
    
    resultsGrid.innerHTML = '';
    let cardCount = 1;
    
    for(const category in dataToDisplay) {
        const categoryData = dataToDisplay[category];
        const card = document.createElement('div');
        card.className = `info-card card-${cardCount}`;
        
        let itemsHTML = '';
        categoryData.items.forEach(item => {
            itemsHTML += `<p>${item.label} <span>${item.value}</span></p>`;
        });
        
        let extraContent = '';
        
        if(category === 'players' && categoryData.playersList && categoryData.playersList.length > 0) {
            extraContent = '<div class="players-list">';
            categoryData.playersList.slice(0, 10).forEach(player => {
                const playerName = player.name || player;
                extraContent += `
                    <div class="player-item">
                        <div class="player-avatar"></div>
                        <span style="color:#ffffff">${playerName}</span>
                    </div>
                `;
            });
            if(categoryData.playersList.length > 10) {
                extraContent += `<div style="color:#888; padding: 10px; text-align: center;">+${categoryData.playersList.length - 10} más</div>`;
            }
            extraContent += '</div>';
        }
        
        if(category === 'plugins') {
            if(categoryData.pluginsList.length > 0) {
                extraContent = '<div class="plugins-list-container">';
                categoryData.pluginsList.forEach((plugin, index) => {
                    extraContent += `
                        <div class="plugin-item">
                            <i class="fas fa-plug"></i>
                            <span>${plugin}</span>
                            <span class="plugin-count">#${index + 1}</span>
                        </div>
                    `;
                });
                extraContent += '</div>';
            } else {
                extraContent = '<div style="text-align: center; padding: 20px; color: #888; font-style: italic;">No disponible (query desactivado o sin plugins)</div>';
            }
        }
        
        card.innerHTML = `
            <h3 class="card-title"><i class="${categoryData.icon}"></i> ${categoryData.title}</h3>
            <div class="card-content">
                ${itemsHTML}
                ${extraContent}
            </div>
        `;
        
        resultsGrid.appendChild(card);
        cardCount = cardCount > 4 ? 1 : cardCount + 1;
    }
    
    resultsElement.style.display = 'block';
}

function showError(message) {
    const errorDiv = document.getElementById('errorMessage');
    const resultsElement = document.getElementById('results');
    const loadingElement = document.getElementById('loading');
    
    if (!errorDiv) return;
    
    errorDiv.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 15px;">
            <i class="fas fa-exclamation-triangle" style="color:#ffaa00; font-size: 1.8rem; margin-top: 2px;"></i>
            <div style="flex: 1;">
                <div style="color:#ff5555; font-size: 1.1rem; font-weight: bold; margin-bottom: 5px;">
                    <i class="fas fa-times-circle"></i> Error en el análisis
                </div>
                <div style="color:#ffaaaa; margin-bottom: 8px;">${message}</div>
                <div style="color:#888; font-size: 0.9rem; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 5px;">
                    <i class="fas fa-info-circle"></i> API: <strong style="color:#00aaff">mcsrvstat.us + mcstatus.io</strong> | 
                    Verifica que el servidor esté online y la IP:PUERTO sean correctos
                </div>
                <div style="color:#888; font-size: 0.9rem; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 5px; margin-top: 10px;">
                    <i class="fas fa-lightbulb"></i> <strong>Consejos:</strong><br>
                    - Para servidores Bedrock usa: <code style="color:#00ffff">IP:19132</code><br>
                    - Para servidores Java usa solo: <code style="color:#00ffff">IP o dominio</code><br>
                    - Intenta con la detección automática primero
                </div>
            </div>
        </div>
    `;
    errorDiv.style.display = 'block';
    
    if (resultsElement) resultsElement.style.display = 'none';
    if (loadingElement) loadingElement.style.display = 'none';
}

document.getElementById('target').addEventListener('keypress', function(e) {
    if(e.key === 'Enter') {
        document.getElementById('analyzeBtn').click();
    }
});

document.getElementById('target').value = '';

document.getElementById('target').addEventListener('focus', function() {
    if(!this.value) {
        this.placeholder = 'Ej: play.hypixel.net (Java) o 8.8.8.8:19132 (Bedrock)';
    }
});
</script>
</body>
</html>